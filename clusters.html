<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VeriTechIQ – Psychographic Segments (Demo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-6 space-y-6">

    <!-- Top Nav: match demo folder -->
    <nav class="mb-2 border-b border-slate-800 pb-2">
      <div class="flex flex-wrap items-center gap-2 text-xs">
        <a
          href="./vei_v2_demo.html"
          class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/70 px-3 py-1.5
                 font-medium text-slate-200 hover:border-sky-500/60 hover:text-sky-300 transition"
        >
          <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
          <span>Home · VEI v2</span>
        </a>

        <a
          href="./predictive.html"
          class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/70 px-3 py-1.5
                 font-medium text-slate-200 hover:border-sky-500/60 hover:text-sky-300 transition"
        >
          <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
          <span>Predictive Strength</span>
        </a>

        <a
          href="./actions.html"
          class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/70 px-3 py-1.5
                 font-medium text-slate-200 hover:border-sky-500/60 hover:text-sky-300 transition"
        >
          <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
          <span>Action Engine</span>
        </a>

        <span
          class="inline-flex items-center gap-1 rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1.5
                 font-medium text-emerald-200"
        >
          <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
          <span>Clusters</span>
        </span>

        <a
          href="./roi_simulation.html"
          class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/70 px-3 py-1.5
                 font-medium text-slate-200 hover:border-sky-500/60 hover:text-sky-300 transition"
        >
          <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
          <span>ROI Simulation</span>
        </a>
      </div>
    </nav>

    <!-- Header with ORG selector -->
    <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div class="space-y-1">
        <h1 class="text-2xl sm:text-3xl font-semibold tracking-tight">
          Psychographic Segments
        </h1>
        <p class="text-sm text-slate-300">
          Tier-3 segments (Trust, Clarity, Motivation, ROI-Intent) that explain <span class="text-slate-100 font-medium">why</span> people respond — not just whether they clicked.
        </p>

        <p id="scopeLine" class="text-[11px] text-slate-400">
          Scope: <span id="scopeOrg" class="font-semibold text-sky-300">—</span>
          <span class="text-slate-600">·</span>
          Campaign: <span id="scopeCampaign" class="font-semibold text-slate-200">—</span>
        </p>
      </div>

      <div class="flex flex-col items-stretch gap-2 sm:items-end sm:gap-3">
        <!-- ORG selector -->
        <div class="flex items-center gap-2 justify-end">
          <span class="text-[11px] font-semibold uppercase tracking-wide text-slate-400">Org</span>
          <div
            id="orgSelector"
            class="inline-flex items-center rounded-full border border-slate-700 bg-slate-900/80 p-1 text-xs font-medium shadow-sm"
          >
            <button
              type="button"
              class="org-pill rounded-full px-3 py-1 text-[11px] tracking-wide text-slate-200 hover:bg-slate-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/70 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950"
              data-org="democo"
            >DemoCo</button>

            <button
              type="button"
              class="org-pill rounded-full px-3 py-1 text-[11px] tracking-wide text-slate-200 hover:bg-slate-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/70 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950"
              data-org="hubspot"
            >HubSpot</button>

            <button
              type="button"
              class="org-pill rounded-full px-3 py-1 text-[11px] tracking-wide text-slate-200 hover:bg-slate-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/70 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950"
              data-org="salesforce"
            >Salesforce</button>

            <button
              type="button"
              class="org-pill rounded-full px-3 py-1 text-[11px] tracking-wide text-slate-200 hover:bg-slate-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/70 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950"
              data-org="all"
            >All orgs</button>
          </div>
        </div>

        <!-- Campaign filter -->
        <div class="flex items-center gap-2 justify-end">
          <input
            id="campaignInput"
            type="text"
            placeholder="vip"
            class="w-40 sm:w-56 rounded-xl border border-slate-700 bg-slate-900/70 px-3 py-2 text-sm
                   placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500/70"
          />
          <button
            id="campaignButton"
            class="rounded-xl bg-sky-500 hover:bg-sky-400 active:bg-sky-600 px-4 py-2
                   text-sm font-medium text-slate-950 transition"
          >Apply</button>
        </div>
      </div>
    </header>

    <!-- Reliability banner -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
        <div class="space-y-1">
          <div class="flex items-center gap-2">
            <span class="text-sm font-semibold tracking-wide text-slate-100">Decision Readiness</span>
            <span id="reliabilityBadge"
              class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-[11px] font-medium uppercase tracking-wide bg-slate-800"
            >—</span>
          </div>
          <p id="reliabilityBody" class="text-xs text-slate-300">
            —
          </p>
          <p id="reliabilityMeta" class="text-[11px] text-slate-400">Cronbach’s α: — · Tier-3 n: —</p>
        </div>

        <div class="flex flex-wrap gap-2 text-[11px] text-slate-400">
          <span class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-950/40 px-3 py-1">
            <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
            Green: α ≥ .70 and n ≥ 100
          </span>
          <span class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-950/40 px-3 py-1">
            <span class="h-1.5 w-1.5 rounded-full bg-amber-300"></span>
            Emerging: close, still stabilizing
          </span>
          <span class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-950/40 px-3 py-1">
            <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
            Learning: exploratory only
          </span>
        </div>
      </div>
    </section>

    <!-- Main grid -->
    <section class="grid gap-4 lg:grid-cols-3">
      <!-- Segments -->
      <div class="lg:col-span-2 space-y-3">
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold tracking-wide text-slate-100">Segments</h2>
          <p id="nRespondents" class="text-xs text-slate-400">— respondents</p>
        </div>

        <div id="segmentsWrap" class="space-y-3">
          <!-- injected -->
        </div>
      </div>

      <!-- Distributions + notes -->
      <aside class="space-y-4">
        <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
          <h2 class="text-sm font-semibold tracking-wide text-slate-100">Construct Distributions</h2>
          <p class="mt-1 text-[11px] text-slate-400">
            Quick sanity check: are segments carving meaningful differences, or just re-labeling a tight cluster?
          </p>

          <div id="distGrid" class="mt-4 grid grid-cols-1 gap-3">
            <!-- injected -->
          </div>

          <p class="mt-4 text-[11px] text-slate-400">
            Scale: 1–7 Likert. Use distributions + reliability gate before you “act like this is truth.”
          </p>
        </div>

        <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
          <h2 class="text-sm font-semibold tracking-wide text-slate-100">How to use this</h2>
          <ul class="mt-2 space-y-1.5 text-[12px] text-slate-300 list-disc list-inside">
            <li>Pick one segment, run one change, measure lift.</li>
            <li>Segments guide <span class="text-slate-100 font-medium">message design</span>, not just targeting.</li>
            <li>When “Emerging,” use as hypothesis fuel. When green, use as planning input.</li>
          </ul>
        </div>
      </aside>
    </section>

    <!-- Footer -->
    <div class="pt-10 border-t border-slate-800 text-[11px] leading-relaxed text-slate-400">
      <p class="font-semibold text-slate-200 mb-2">
        VeriTechIQ Verified Engagement Intelligence — Demo Notes
      </p>
      <p>
        This clusters page is a static demo dataset (no live API calls) to ensure stability during investor review.
        In production, clusters are computed from verified Tier-3 responses with reliability gating and minimum segment-size rules.
      </p>

      <div class="w-full flex flex-col items-center mt-8 pt-6 border-t border-slate-800">
        <p class="text-[10px] tracking-wide uppercase font-semibold text-slate-300">
          VeriTechIQ™ Verified Engagement Intelligence
        </p>
        <p class="text-[10px] text-slate-500 mt-1">
          © 2025 VeriTechIQ. All rights reserved.
        </p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // ─────────────────────────────────────────────────────────────
      // Query params
      // ─────────────────────────────────────────────────────────────
      const params = new URLSearchParams(window.location.search || "");
      const qpOrg = (params.get("org") || "democo").toLowerCase();
      const qpCampaign = (params.get("campaign") || "vip").trim();

      // ─────────────────────────────────────────────────────────────
      // Demo data (align to your "bible" reliability bands)
      // ─────────────────────────────────────────────────────────────
      // Notes:
      // - DemoCo: α 0.68, n 280 (Emerging)
      // - HubSpot: α 0.66, n 420 (Emerging)
      // - Salesforce: α 0.55, n 42 (Learning)
      // - All: α 0.74, n 120 (Decision-Ready)  <-- matches your earlier "all" narrative
      const DEMO = {
        democo: {
          label: "DemoCo",
          campaign: "vip",
          reliability: { band: "amber", label: "Emerging", alpha: 0.68, n: 280,
            body: "Signals are consistent enough to guide controlled experiments, but not yet locked for high-stakes planning. Treat segments as directional, and validate with A/B tests."
          },
          algorithm: "kmeans-lite (Tier-3 centroid split)",
          respondents: 280,
          distributions: {
            trust: { mean: 5.6, min: 3.8, max: 6.7 },
            clarity: { mean: 4.9, min: 3.4, max: 6.3 },
            motivation: { mean: 5.3, min: 3.6, max: 6.6 },
            roi_intent: { mean: 5.0, min: 3.2, max: 6.5 }
          },
          segments: [
            {
              id: "A",
              label: "Confident Converts",
              share: 0.56,
              n: 157,
              primary_pattern: "high_trust_high_roi",
              psych_description: "They already believe you. Their conversion is mainly blocked by small friction (timing, offer clarity, and one missing proof point).",
              centroid: { trust: 6.2, clarity: 5.0, motivation: 5.8, roi_intent: 5.9 },
              quick_actions: [
                "Push a shorter CTA path (reduce steps, reduce uncertainty).",
                "Add a single strong proof asset (benchmark, customer logo, or quantified outcome).",
                "Use scarcity/time-boxing carefully — they respond, but hate gimmicks."
              ]
            },
            {
              id: "B",
              label: "Skeptical Researchers",
              share: 0.31,
              n: 87,
              primary_pattern: "low_clarity_high_motivation",
              psych_description: "They want the outcome, but don’t trust the path yet. They need clarity + safety signals before they move.",
              centroid: { trust: 4.6, clarity: 4.1, motivation: 5.6, roi_intent: 4.4 },
              quick_actions: [
                "Lead with a 3-bullet “How it works” + constraints (reduce ambiguity).",
                "Offer risk reversal (pilot, guarantee, or clear exit).",
                "Use comparison framing: why this vs. their default approach."
              ]
            },
            {
              id: "C",
              label: "Polite Passives",
              share: 0.13,
              n: 36,
              primary_pattern: "low_motivation_low_roi",
              psych_description: "They’re not opposed — they’re unconvinced it matters. They require a sharper problem framing or a more specific outcome.",
              centroid: { trust: 5.1, clarity: 5.0, motivation: 4.1, roi_intent: 3.8 },
              quick_actions: [
                "Reframe the pain: quantify cost of inaction (time, money, risk).",
                "Target narrower use-cases (one job-to-be-done, one persona).",
                "Stop over-nurturing; move them to a low-frequency track."
              ]
            }
          ]
        },

        hubspot: {
          label: "HubSpot",
          campaign: "vip",
          reliability: { band: "amber", label: "Emerging", alpha: 0.66, n: 420,
            body: "Useful segmentation patterns are forming. Use this to tailor copy and prioritize experiments, but treat lift claims as directional until reliability stabilizes."
          },
          algorithm: "kmeans-lite (Tier-3 centroid split)",
          respondents: 420,
          distributions: {
            trust: { mean: 5.1, min: 3.3, max: 6.6 },
            clarity: { mean: 4.7, min: 3.1, max: 6.2 },
            motivation: { mean: 5.0, min: 3.2, max: 6.5 },
            roi_intent: { mean: 4.6, min: 2.9, max: 6.3 }
          },
          segments: [
            {
              id: "A",
              label: "Workflow Believers",
              share: 0.49,
              n: 206,
              primary_pattern: "high_clarity_high_trust",
              psych_description: "They understand the workflow and feel safe adopting — the main lever is highlighting measurable outcomes.",
              centroid: { trust: 5.8, clarity: 5.5, motivation: 5.2, roi_intent: 5.1 },
              quick_actions: [
                "Make ROI explicit (before/after benchmark, time saved).",
                "Offer a template or “starter kit” to reduce setup work.",
                "Use product screenshots that match their mental model."
              ]
            },
            {
              id: "B",
              label: "Outcome Seekers",
              share: 0.37,
              n: 155,
              primary_pattern: "high_motivation_mid_clarity",
              psych_description: "They want results fast but don’t fully understand the mechanism. Their lever is clarity + proof sequencing.",
              centroid: { trust: 4.9, clarity: 4.1, motivation: 5.8, roi_intent: 4.7 },
              quick_actions: [
                "Move proof earlier (case study first, details second).",
                "Add a 30-second “what you get” summary above the fold.",
                "Use an implementation promise (weeks, not months)."
              ]
            },
            {
              id: "C",
              label: "Cautious Evaluators",
              share: 0.14,
              n: 59,
              primary_pattern: "mid_trust_low_roi",
              psych_description: "They’re open, but unsure the payoff is worth switching. They need sharper differentiation and migration safety.",
              centroid: { trust: 5.2, clarity: 4.6, motivation: 4.3, roi_intent: 3.9 },
              quick_actions: [
                "Address switching costs directly (migration, integration, training).",
                "Show “compatibility with current stack” (reduce perceived risk).",
                "Offer a small pilot outcome within 2 weeks."
              ]
            }
          ]
        },

        salesforce: {
          label: "Salesforce",
          campaign: "vip",
          reliability: { band: "gray", label: "Learning", alpha: 0.55, n: 42,
            body: "Too few Tier-3 responses to trust segment boundaries. This view is exploratory only — collect more Tier-3 before acting confidently."
          },
          algorithm: "fallback (median split)",
          respondents: 42,
          distributions: {
            trust: { mean: 5.0, min: 4.0, max: 6.2 },
            clarity: { mean: 4.4, min: 3.6, max: 5.6 },
            motivation: { mean: 4.8, min: 3.7, max: 6.0 },
            roi_intent: { mean: 4.2, min: 3.1, max: 5.6 }
          },
          segments: [
            {
              id: "A",
              label: "Single Cluster (early sample)",
              share: 1.00,
              n: 42,
              primary_pattern: "insufficient_sample",
              psych_description: "With n=42, VeriTechIQ collapses profiles into a single exploratory cluster to avoid false segmentation.",
              centroid: { trust: 5.0, clarity: 4.4, motivation: 4.8, roi_intent: 4.2 },
              quick_actions: [
                "Collect Tier-3: target +60 responses to begin stable segmentation.",
                "In the meantime, run 1–2 broad message variants (clarity-first vs proof-first).",
                "Use Tier-2 open text to discover unknown objections."
              ]
            }
          ]
        },

        all: {
          label: "All orgs",
          campaign: "vip",
          reliability: { band: "green", label: "Decision-Ready", alpha: 0.74, n: 120,
            body: "Aggregate segments are stable enough for planning conversations. Still validate in-org before major bets, but this is a decision-grade signal for prioritization."
          },
          algorithm: "aggregate clustering (Tier-3)",
          respondents: 120,
          distributions: {
            trust: { mean: 5.4, min: 3.6, max: 6.6 },
            clarity: { mean: 4.8, min: 3.3, max: 6.2 },
            motivation: { mean: 5.2, min: 3.5, max: 6.5 },
            roi_intent: { mean: 4.8, min: 3.0, max: 6.3 }
          },
          segments: [
            {
              id: "A",
              label: "Proof-Driven Buyers",
              share: 0.52,
              n: 62,
              primary_pattern: "trust_drives_roi",
              psych_description: "Across orgs, trust is the strongest lever: when proof lands, ROI-Intent follows.",
              centroid: { trust: 6.0, clarity: 4.8, motivation: 5.4, roi_intent: 5.4 },
              quick_actions: [
                "Standardize proof blocks (case study, benchmark, logos).",
                "Quantify ROI in the first 2 scrolls.",
                "Use consistent claims across channels (reduce cognitive dissonance)."
              ]
            },
            {
              id: "B",
              label: "Clarity-First Adopters",
              share: 0.34,
              n: 41,
              primary_pattern: "clarity_unblocks_trust",
              psych_description: "They need to understand the mechanism first. When clarity rises, trust stops being the bottleneck.",
              centroid: { trust: 5.0, clarity: 5.6, motivation: 5.1, roi_intent: 4.6 },
              quick_actions: [
                "Lead with “how it works” before the pitch.",
                "Use diagrams/screenshots (remove ambiguity).",
                "Clarify what’s NOT included (reduces fear)."
              ]
            },
            {
              id: "C",
              label: "Low-Intent Noise",
              share: 0.14,
              n: 17,
              primary_pattern: "low_roi_intent",
              psych_description: "A small slice is simply low intent. The move is to suppress frequency and stop distorting your funnel narrative.",
              centroid: { trust: 4.8, clarity: 4.3, motivation: 4.0, roi_intent: 3.4 },
              quick_actions: [
                "Reduce sends / retargeting frequency.",
                "Route to education track (monthly).",
                "Focus experiments on higher-intent segments."
              ]
            }
          ]
        }
      };

      // ─────────────────────────────────────────────────────────────
      // DOM
      // ─────────────────────────────────────────────────────────────
      const orgPills = document.querySelectorAll(".org-pill");
      const campaignInput = document.getElementById("campaignInput");
      const campaignButton = document.getElementById("campaignButton");

      const scopeOrg = document.getElementById("scopeOrg");
      const scopeCampaign = document.getElementById("scopeCampaign");

      const reliabilityBadge = document.getElementById("reliabilityBadge");
      const reliabilityBody = document.getElementById("reliabilityBody");
      const reliabilityMeta = document.getElementById("reliabilityMeta");

      const nRespondents = document.getElementById("nRespondents");
      const segmentsWrap = document.getElementById("segmentsWrap");
      const distGrid = document.getElementById("distGrid");

      // ─────────────────────────────────────────────────────────────
      // State
      // ─────────────────────────────────────────────────────────────
      let activeOrg = (DEMO[qpOrg] ? qpOrg : "democo");
      let activeCampaign = qpCampaign || "vip";

      // ─────────────────────────────────────────────────────────────
      // Helpers
      // ─────────────────────────────────────────────────────────────
      const bandColors = {
        green: { badge: "bg-emerald-500/20 border border-emerald-400/70 text-emerald-200", dot: "bg-emerald-400", label: "Decision-Ready" },
        amber: { badge: "bg-amber-500/20 border border-amber-400/80 text-amber-200", dot: "bg-amber-300", label: "Emerging" },
        red:   { badge: "bg-rose-500/20 border border-rose-400/80 text-rose-200", dot: "bg-rose-400", label: "Weak" },
        gray:  { badge: "bg-slate-700/40 border border-slate-500/80 text-slate-200", dot: "bg-slate-400", label: "Learning" }
      };

      function applyOrgPillsUI() {
        orgPills.forEach(function (pill) {
          pill.classList.remove("bg-emerald-500","text-slate-950","shadow-sm","shadow-emerald-500/40");
          pill.classList.add("text-slate-200");
          if ((pill.dataset.org || "democo") === activeOrg) {
            pill.classList.add("bg-emerald-500","text-slate-950","shadow-sm","shadow-emerald-500/40");
            pill.classList.remove("text-slate-200");
          }
        });
      }

      function fmtPct(x) {
        const n = Number(x);
        if (!isFinite(n)) return "—";
        return (n * 100).toFixed(0) + "%";
      }
      function fmt1(x) {
        const n = Number(x);
        if (!isFinite(n)) return "—";
        return n.toFixed(1);
      }
      function fmt2(x) {
        const n = Number(x);
        if (!isFinite(n)) return "—";
        return n.toFixed(2);
      }

      function patternLabel(code) {
        if (!code) return "Pattern";
        return code.replace(/_/g, " ").replace(/\b\w/g, (m) => m.toUpperCase());
      }

      function segmentCard(seg, relBand) {
        const sharePct = fmtPct(seg.share);
        const band = bandColors[relBand] ? relBand : "gray";
        const b = bandColors[band];

        const actions = Array.isArray(seg.quick_actions) ? seg.quick_actions : [];
        const actionsHtml = actions.length
          ? `<ul class="mt-3 space-y-1.5 text-[12px] text-slate-300 list-disc list-inside">
              ${actions.map(a => `<li>${escapeHtml(a)}</li>`).join("")}
            </ul>`
          : `<p class="mt-3 text-[12px] text-slate-400">No recommended actions available yet.</p>`;

        return `
          <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
            <div class="flex items-start justify-between gap-3">
              <div>
                <p class="text-[11px] uppercase tracking-wide text-slate-400 font-semibold">Segment ${escapeHtml(seg.id || "—")}</p>
                <h3 class="text-base font-semibold text-slate-100">${escapeHtml(seg.label || "Segment")}</h3>
                <p class="mt-1 text-sm text-slate-300">${escapeHtml(seg.psych_description || "")}</p>
              </div>

              <div class="text-right">
                <div class="text-xs text-slate-300"><span class="font-semibold text-slate-100 tabular-nums">${(seg.n || 0).toLocaleString()}</span> respondents</div>
                <div class="mt-1 inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-[11px] ${b.badge}">
                  <span class="h-2 w-2 rounded-full ${b.dot}"></span>
                  <span>${escapeHtml(sharePct)} of Tier-3 sample</span>
                </div>
                <div class="mt-2 inline-flex items-center gap-1.5 rounded-full border border-slate-700 bg-slate-950/40 px-2.5 py-0.5 text-[11px] text-slate-200">
                  <span class="h-2 w-2 rounded-full bg-sky-300"></span>
                  <span>${escapeHtml(patternLabel(seg.primary_pattern))}</span>
                </div>
              </div>
            </div>

            <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2">
              ${scorePill("Trust", seg.centroid && seg.centroid.trust)}
              ${scorePill("Clarity", seg.centroid && seg.centroid.clarity)}
              ${scorePill("Motivation", seg.centroid && seg.centroid.motivation)}
              ${scorePill("ROI-Intent", seg.centroid && seg.centroid.roi_intent)}
            </div>

            <div class="mt-4 rounded-xl border border-slate-800 bg-slate-950/30 p-3">
              <p class="text-[11px] uppercase tracking-wide text-slate-400 font-semibold">What to do next</p>
              ${actionsHtml}
            </div>
          </article>
        `;
      }

      function scorePill(label, val) {
        const v = Number(val);
        const txt = isFinite(v) ? v.toFixed(1) : "—";
        // light heuristic coloring: high >=5.6 green, mid >=4.7 sky, else amber
        const cls =
          !isFinite(v) ? "border-slate-700 text-slate-300"
          : v >= 5.6 ? "border-emerald-500/40 text-emerald-200"
          : v >= 4.7 ? "border-sky-500/40 text-sky-200"
          : "border-amber-500/40 text-amber-200";

        return `
          <div class="rounded-xl border ${cls} bg-slate-950/40 px-3 py-2">
            <div class="text-[10px] uppercase tracking-wide text-slate-400 font-semibold">${escapeHtml(label)}</div>
            <div class="mt-0.5 text-lg font-semibold tabular-nums">${escapeHtml(txt)}</div>
          </div>
        `;
      }

      function distRow(label, d) {
        const mean = d && isFinite(d.mean) ? fmt1(d.mean) : "—";
        const min = d && isFinite(d.min) ? fmt1(d.min) : "—";
        const max = d && isFinite(d.max) ? fmt1(d.max) : "—";

        return `
          <div class="rounded-xl border border-slate-800 bg-slate-950/30 p-3">
            <div class="text-xs font-semibold text-slate-100">${escapeHtml(label)}</div>
            <div class="mt-2 flex items-center justify-between text-[12px] text-slate-300">
              <span>μ <span class="font-semibold text-slate-100 tabular-nums">${escapeHtml(mean)}</span></span>
              <span class="text-slate-400">min <span class="tabular-nums">${escapeHtml(min)}</span> · max <span class="tabular-nums">${escapeHtml(max)}</span></span>
            </div>
          </div>
        `;
      }

      function escapeHtml(str) {
        return String(str == null ? "" : str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function setQueryParamSilently(key, value) {
        const p = new URLSearchParams(window.location.search || "");
        if (value == null || value === "") p.delete(key);
        else p.set(key, value);
        const newUrl = window.location.pathname + "?" + p.toString();
        window.history.replaceState({}, "", newUrl);
      }

      // ─────────────────────────────────────────────────────────────
      // Render
      // ─────────────────────────────────────────────────────────────
      function render() {
        const bundle = DEMO[activeOrg] || DEMO.democo;

        // Scope line
        scopeOrg.textContent = bundle.label || "—";
        scopeCampaign.textContent = activeCampaign || bundle.campaign || "vip";

        // Reliability badge + meta
        const r = bundle.reliability || { band: "gray", label: "Learning", alpha: null, n: null, body: "" };
        const b = bandColors[r.band] || bandColors.gray;

        reliabilityBadge.className =
          "inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-[11px] font-medium uppercase tracking-wide " + b.badge;

        reliabilityBadge.innerHTML =
          `<span class="h-2 w-2 rounded-full ${b.dot}"></span><span>${escapeHtml(r.label || b.label)}</span>`;

        reliabilityBody.textContent = r.body || "—";
        reliabilityMeta.textContent =
          "Cronbach’s α: " + (r.alpha != null ? fmt2(r.alpha) : "—") +
          " · Tier-3 n: " + (r.n != null ? Number(r.n).toLocaleString() : "—") +
          " · Algorithm: " + (bundle.algorithm || "—");

        // Respondents
        nRespondents.textContent = (bundle.respondents || 0).toLocaleString() + " respondents";

        // Segments
        const segs = Array.isArray(bundle.segments) ? bundle.segments : [];
        if (!segs.length) {
          segmentsWrap.innerHTML = `
            <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
              <p class="text-sm text-slate-300">No segments available yet for this scope.</p>
              <p class="mt-1 text-[12px] text-slate-400">Collect more Tier-3 responses to unlock clustering.</p>
            </div>
          `;
        } else {
          segmentsWrap.innerHTML = segs.map(s => segmentCard(s, r.band)).join("");
        }

        // Distributions
        const d = bundle.distributions || {};
        distGrid.innerHTML = [
          distRow("Trust", d.trust),
          distRow("Clarity", d.clarity),
          distRow("Motivation", d.motivation),
          distRow("ROI-Intent", d.roi_intent),
        ].join("");

        // Keep URL in sync (for copy/paste links)
        setQueryParamSilently("org", activeOrg);
        setQueryParamSilently("campaign", activeCampaign || "vip");
      }

      // ─────────────────────────────────────────────────────────────
      // Events
      // ─────────────────────────────────────────────────────────────
      orgPills.forEach(function (pill) {
        pill.addEventListener("click", function () {
          activeOrg = (pill.dataset.org || "democo");
          applyOrgPillsUI();
          render();
        });
      });

      campaignButton.addEventListener("click", function () {
        activeCampaign = (campaignInput.value || "").trim() || "vip";
        render();
      });

      campaignInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          activeCampaign = (campaignInput.value || "").trim() || "vip";
          render();
        }
      });

      // Init
      campaignInput.value = qpCampaign || "vip";
      applyOrgPillsUI();
      render();
    })();
  </script>
</body>
</html>
